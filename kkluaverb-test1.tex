\documentclass{ltjsarticle}
\usepackage{KKluaverb}

\begin{luacode*}
  KKLuaVerb.presets["TeXStyle"] = {
    map = { 
      red = { [[\def]], [[\begin]], [[\end]], [[\long]] },
      blue  = { [[\if]], [[\else]], [[\fi]] }
    }, 
    options = { 
      word_boundary = true,
      comment_char = "%",     -- コメント開始
      comment_color = "green", -- コメントの色
      escape_char = "\\"      -- エスケープ文字
    }
  }
\end{luacode*}

\begin{luacode*}
  KKLuaVerb.presets["LuaStyle"] = {
    map = { 
      red = { [[if]], [[else]], [[then]], [[elseif]] , [[end]] },
      blue  = { [[local]], [[function]] }
    },
    options = { word_boundary = true }
  }
\end{luacode*}
\KKvSetMap{ }{␣}
\begin{document}

\KKvUsePreset{TeXStyle}

\KKverb|\def\test\ifああ
あ\elseいいい\fi|

\KKcodeS+
\long\def\foo{%
  ABC DEF EFG
}

\KKcodeE

\KKvLNChange{style=2}
\KKverb|

\long\def\foo{%
  ABC DEF EFG
}

|

\KKvUsePreset{LuaStyle}

\KKverb|if A == B then else A_if B_else end|

\end{document}