\documentclass{ltjsarticle}
\usepackage{KKluaverb}

\begin{luacode*}
  KKLuaVerb.presets["TeXStyle"] = {
    map = { 
      brown = { [[\def]], [[\begin]], [[\end]], [[\long]] },
      Magenta  = { [[\if]], [[\else]], [[\fi]] },
    }, 
    options = { 
      word_boundary = false,
      comment_char = "%",     
      comment_color = "ForestGreen", 
      escape_char = "\\"      
    }
  }
\end{luacode*}

\begin{luacode*}
  KKLuaVerb.presets["LuaStyle"] = {
    map = { 
      Magenta = { [[if]], [[else]], [[then]], [[elseif]] , [[end]] , [[for]] , [[function]], [[return]]},
      ProcessBlue  = { [[local]] , [[true]], [[false]]}
    },
    options = { 
      word_boundary = true,
      comment_char = "--",     
      comment_color = "Cerulean", 
      escape_char = "%"      
    }
  }
\end{luacode*}

\begin{document}

\KKvUsePreset{TeXStyle}

\KKverb|\def\test\ifああ
あ\elseいいい\fi|

\KKcodeS+
  % test comment
  \long\def\foo{%
    ABC DEF EFG
  }
\KKcodeE

\KKvUsePreset{LuaStyle}

\KKcodeS+
  -- test comment
  function KKV.encode_tail(str)
    local s = (str .. "\n"):gsub(ltjflg, "\n")
    return KKV.encode(s)
  end
\KKcodeE

\end{document}