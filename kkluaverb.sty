% KKluaverb.sty
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{KKluaverb}[2026/01/08 v1.3.0]

%%% package
\RequirePackage{luatexbase}
\RequirePackage{pgfkeys, xcolor}
\directlua{require("KKluaverb")}
%%%

%%% kvop
\pgfkeys{
  /kklv/.is family, /kklv/.cd,
  font/.store in  = \kklv@set@font,
  color/.store in = \kklv@set@color,
}
\newcommand{\KKvOpChange}[1]{\pgfkeys{/kklv/.cd, #1}}
\KKvOpChange{font=\ttfamily, color=black}
%%%

%%% def delims
\newtoks\kklv@delims
\newcommand{\KKvSetDelims}[2]{\kklv@delims{{#1}{#2}}}
\KKvSetDelims{|}{|}
%%%

%%% main
\def\KKvS*#1\KKvE*{%
  \begingroup%
    \kklv@set@font%
    \color{\kklv@set@color}%
    \directlua{KKLuaVerb.decode([[#1]])}%
  \endgroup%
}
\directlua{
  luatexbase.add_to_callback("process_input_buffer",
  KKLuaVerb.scanner, "kkluaverb_scanner")
}
\newcommand{\KKverb}{} 
%%%

\endinput